<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

    <!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! DATABASE SCHEMA !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->

    <!-- ACCOUNTS {ОБЩИЙ СПРАВОЧНИК}- таблица с аккаунтами -->
    <changeSet id="1" author="mbragin">
        <createTable tableName="accounts">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="character varying(255)"/>
        </createTable>
    </changeSet>

    <!-- ORGANIZATIONS - организации в каком-то либо аккаунте -->
    <changeSet id="2" author="mbragin">
        <createTable tableName="organizations">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="character varying(255)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="character varying(255)"/>
            <column name="account_id" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint baseTableName="organizations"
                                 baseColumnNames="account_id"
                                 constraintName="organization_account_id"
                                 referencedTableName="accounts"
                                 referencedColumnNames="id"/>
    </changeSet>

    <!-- ADDRESSES {ОБЩИЙ СПРАВОЧНИК}- общий каталог всех адресов системы (заказчики, склады, магазины, пользователи) -->
    <changeSet id="3" author="mbragin">
        <createTable tableName="addresses">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="address" type="character varying(1024)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <!-- PHONES {ОБЩИЙ СПРАВОЧНИК}- общий каталог всех телефонов системы (заказчики, склады, магазины, пользователи) -->
    <changeSet id="4" author="mbragin">
        <createTable tableName="phones">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="phone" type="character varying(1024)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <!-- customers {ОБЩИЙ СПРАВОЧНИК}- общий каталог людей зарегистрированных в системе (пользователи, заказчики) -->
    <changeSet id="5" author="mbragin">
        <createTable tableName="customers">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="first_name" type="character varying(255)"/>
            <column name="last_name" type="character varying(255)"/>
            <column name="email" type="character varying(255)"/>
            <column name="birthday" type="timestamp without time zone"/>
            <column name="organization_id" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint constraintName="customers_organization_id"
                                 baseTableName="customers"
                                 baseColumnNames="organization_id"
                                 referencedTableName="organizations"
                                 referencedColumnNames="id"/>
    </changeSet>

    <!-- customers_ADDRESSES - адреса людей зарегистрированных в системе (у одного человека может быть несколько адресов в базе) -->
    <changeSet id="6" author="mbragin">
        <createTable tableName="customers_addresses">
            <column name="customer_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="address_id" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addUniqueConstraint tableName="customers_addresses"
                             columnNames="customer_id, address_id"/>

        <addForeignKeyConstraint baseTableName="customers_addresses"
                                 baseColumnNames="customer_id"
                                 constraintName="customers_addresses_person_id"
                                 referencedTableName="customers"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="customers_addresses"
                                 baseColumnNames="address_id"
                                 constraintName="customers_addresses_address_id"
                                 referencedTableName="addresses"
                                 referencedColumnNames="id"/>
    </changeSet>

    <!-- customers_PHONES - телефоны людей зарегистрированных в системе (у одного человека может быть несколько телефонов в базе) -->
    <changeSet id="7" author="mbragin">
        <createTable tableName="customers_phones">
            <column name="customer_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="phone_id" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addUniqueConstraint tableName="customers_phones"
                             columnNames="customer_id,phone_id"/>

        <addForeignKeyConstraint baseTableName="customers_phones"
                                 baseColumnNames="customer_id"
                                 constraintName="customers_phones_person_id"
                                 referencedTableName="customers"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="customers_phones"
                                 baseColumnNames="phone_id"
                                 constraintName="customers_phones_phone_id"
                                 referencedTableName="phones"
                                 referencedColumnNames="id"/>
    </changeSet>

    <!-- ORGANIZATIONS_ADDRESSES - адреса организация зарегистрированных в системе (у одного человека может быть несколько адресов в базе) -->
    <changeSet id="8" author="mbragin">
        <createTable tableName="organizations_addresses">
            <column name="organization_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="address_id" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addUniqueConstraint tableName="organizations_addresses"
                             columnNames="organization_id, address_id"/>

        <addForeignKeyConstraint baseTableName="organizations_addresses"
                                 baseColumnNames="organization_id"
                                 constraintName="organizations_addresses_organization_id"
                                 referencedTableName="organizations"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="organizations_addresses"
                                 baseColumnNames="address_id"
                                 constraintName="organizations_addresses_address_id"
                                 referencedTableName="addresses"
                                 referencedColumnNames="id"/>
    </changeSet>

    <!-- ORGANIZATIONS_PHONES - телефоны организаций зарегистрированных в системе (у одного человека может быть несколько телефонов в базе) -->
    <changeSet id="9" author="mbragin">
        <createTable tableName="organizations_phones">
            <column name="organization_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="phone_id" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addUniqueConstraint tableName="organizations_phones"
                             columnNames="organization_id,phone_id"/>

        <addForeignKeyConstraint baseTableName="organizations_phones"
                                 baseColumnNames="organization_id"
                                 constraintName="organizations_phones_organization_id"
                                 referencedTableName="organizations"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="organizations_phones"
                                 baseColumnNames="phone_id"
                                 constraintName="organizations_phones_phone_id"
                                 referencedTableName="phones"
                                 referencedColumnNames="id"/>
    </changeSet>

    <!-- USER_STATUSES - статусы пользователей (активен, заблокирован, т.д.) -->
    <changeSet id="10" author="mbragin">
        <createTable tableName="user_statuses">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="character varying(255)"/>
        </createTable>
    </changeSet>

    <!-- USERS - пользователи системы в рамках одного аккаунта
        (те пользователи, у которых account_id != null автоматически являются
        администраторами аккаунта и всех организаций в нем) -->
    <changeSet id="11" author="mbragin">
        <createTable tableName="users">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>

            <column name="created" type="timestamp without timezone">
                <constraints nullable="false"/>
            </column>
            <column name="username" type="character varying(255)">
                <constraints nullable="false"/>
            </column>
            <column name="password" type="character varying(255)">
                <constraints nullable="false"/>
            </column>
            <column name="last_logged" type="timestamp without timezone"> <!-- последнее время входа в систему -->
                <constraints nullable="true"/>
            </column>
            <column name="account_id" type="bigint"> <!-- аккаунт, в котором пользователя является администратором -->
                <constraints nullable="false"/>
            </column>
            <column name="status_id" type="bigint"> <!-- статус пользователся (ENABLED|DISABLED) -->
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint baseTableName="users"
                                 baseColumnNames="account_id"
                                 constraintName="user_account_id"
                                 referencedTableName="accounts"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="users"
                                 baseColumnNames="status_id"
                                 constraintName="users_status_id"
                                 referencedTableName="user_statuses"
                                 referencedColumnNames="id"/>
    </changeSet>

    <!-- ROLES {ОБЩИЙ СПРАВОЧНИК} - роли в системе -->
    <changeSet id="12" author="mbragin">
        <createTable tableName="roles">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="character varying(255)"/>
            <column name="description" type="character varying(255)"/>
        </createTable>
    </changeSet>

    <!-- PERSONS_ADDRESSES - адреса людей зарегистрированных в системе (у одного человека может быть несколько адресов в базе) -->
    <changeSet id="13" author="mbragin">
        <createTable tableName="accounts_roles">
            <column name="account_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="role_id" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addUniqueConstraint tableName="accounts_roles"
                             columnNames="account_id, role_id"/>

        <addForeignKeyConstraint baseTableName="accounts_roles"
                                 baseColumnNames="account_id"
                                 constraintName="accounts_roles_account_id"
                                 referencedTableName="accounts"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="accounts_roles"
                                 baseColumnNames="role_id"
                                 constraintName="accounts_roles_role_id"
                                 referencedTableName="roles"
                                 referencedColumnNames="id"/>
    </changeSet>

    <!-- USERS_ORGANIZATIONS - пользователи в организациях с определением ролей -->
    <changeSet id="14" author="mbragin">
        <createTable tableName="users_organizations">
            <column name="user_id" type="bigint"> <!-- пользователь -->
                <constraints nullable="false"/>
            </column>
            <column name="org_id" type="bigint"> <!-- организация -->
                <constraints nullable="false"/>
            </column>
            <column name="role_id" type="bigint"> <!-- роль пользователя user_id в организации org_id -->
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addUniqueConstraint tableName="users_organizations"
                             columnNames="user_id, org_id"/>

        <addForeignKeyConstraint baseTableName="users_organizations"
                                 baseColumnNames="user_id"
                                 constraintName="user_org_user_id"
                                 referencedTableName="users"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="users_organizations"
                                 baseColumnNames="org_id"
                                 constraintName="user_org_org_id"
                                 referencedTableName="organizations"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="users_organizations"
                                 baseColumnNames="role_id"
                                 constraintName="user_org_role_id"
                                 referencedTableName="roles"
                                 referencedColumnNames="id"/>
    </changeSet>

    <!-- GOODS - товары в рамках одного аккаунта -->
    <changeSet id="15" author="mbragin">
        <createTable tableName="goods">
            <column name="id" type="bigint">
                <constraints primaryKey="true"/>
            </column>
            <column name="price" type="double precision"/>
            <column name="name" type="character varying(255)">
                <constraints nullable="false"/>
            </column>
            <column name="account_id" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint baseTableName="goods"
                                 baseColumnNames="account_id"
                                 constraintName="goods_account_id"
                                 referencedTableName="accounts"
                                 referencedColumnNames="id"/>

    </changeSet>

    <!-- DELIVERY_TYPE {ОБЩИЙ СПРАВОЧНИК} - тип получения заказа (варианты доставки, самовывоз, т.д.) -->
    <changeSet id="16" author="mbragin">
        <createTable tableName="delivery_types">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="character varying(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <!-- ORDER_STATUSES - статусы доставки в рамках организации -->
    <changeSet id="18" author="mbragin">
        <createTable tableName="order_statuses">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="character varying(255)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="character varying(255)">
                <constraints nullable="true"/>
            </column>
            <column name="organization_id" type="bigint">
                <constraints nullable="true"/>
            </column>
        </createTable>

        <addForeignKeyConstraint constraintName="order_statuses_organization_id"
                                 baseTableName="order_statuses"
                                 baseColumnNames="organization_id"
                                 referencedTableName="organizations"
                                 referencedColumnNames="id"/>
    </changeSet>

    <!-- ORDERS - заказы  -->
    <changeSet id="19" author="mbragin">
        <createTable tableName="orders">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="order_date" type="timestamp without time zone"> <!-- время заказа -->
                <constraints nullable="false"/>
            </column>
            <column name="delivery_date" type="timestamp without time zone"> <!-- время когда будет доставлено -->
            </column>
            <column name="order_number" type="character varying(255)"> <!-- номер заказа -->
                <constraints nullable="false"/>
            </column>
            <column name="customer_id" type="bigint"> <!-- заказчик -->
                <constraints nullable="false"/>
            </column>
            <column name="organization_id" type="bigint"> <!-- в какой организации заказали -->
                <constraints nullable="false"/>
            </column>
            <column name="status_id" type="bigint"> <!-- статус заказа -->
                <constraints nullable="false"/>
            </column>
            <column name="user_id" type="bigint"> <!-- кто принял заказ -->
            </column>
            <column name="address_id"
                    type="bigint"> <!-- адрес доставки (либо берется из адреса заказчика, либо добавляется новый) -->
            </column>
            <column name="phone_id"
                    type="bigint"> <!-- телефон доставки (либо берется из телефонов заказчика, либо добавляется новый) -->
            </column>
        </createTable>

        <addForeignKeyConstraint baseTableName="orders"
                                 baseColumnNames="customer_id"
                                 constraintName="order_customer_id"
                                 referencedTableName="customers"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="orders"
                                 baseColumnNames="organization_id"
                                 constraintName="order_organization_id"
                                 referencedTableName="organizations"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="orders"
                                 baseColumnNames="status_id"
                                 constraintName="order_status_id"
                                 referencedTableName="order_statuses"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="orders"
                                 baseColumnNames="user_id"
                                 constraintName="order_user_id"
                                 referencedTableName="users"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="orders"
                                 baseColumnNames="address_id"
                                 constraintName="order_address_id"
                                 referencedTableName="addresses"
                                 referencedColumnNames="id"/>

    </changeSet>

    <!-- ORDERS_GOODS - товары, которые будут в заказе -->
    <changeSet id="20" author="mbragin">
        <createTable tableName="orders_goods">
            <column name="order_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="good_id" type="bigint"> <!-- товар -->
                <constraints nullable="false"/>
            </column>
            <column name="count" type="bigint"> <!-- количество товаров good_id -->
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addUniqueConstraint tableName="orders_goods"
                             columnNames="order_id, good_id"/>

        <addForeignKeyConstraint baseTableName="orders_goods"
                                 baseColumnNames="order_id"
                                 constraintName="orders_goods_order_id"
                                 referencedTableName="orders"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="orders_goods"
                                 baseColumnNames="good_id"
                                 constraintName="orders_goods_good_id"
                                 referencedTableName="goods"
                                 referencedColumnNames="id"/>
    </changeSet>

    <!-- MENU_ITEMS - пункты меню -->
    <changeSet id="21" author="mbragin">
        <createTable tableName="menu_items">
            <column name="id" type="bigint">
                <constraints primaryKey="true"/>
            </column>
            <column name="visible" type="boolean"/>
            <column name="name" type="character varying(255)">
                <constraints nullable="false"/>
            </column>
            <column name="parent_id" type="bigint"/>
        </createTable>

        <addForeignKeyConstraint baseTableName="menu_items"
                                 baseColumnNames="parent_id"
                                 constraintName="menu_items_menu_item_id"
                                 referencedTableName="menu_items"
                                 referencedColumnNames="id"/>
    </changeSet>

    <!-- FUNCTIONS - фнкции (на каждое действие - нажатие на кнопку, пункт меню - в системе существует своя функция) -->
    <changeSet id="22" author="mbragin">
        <createTable tableName="functions">
            <column name="id" type="bigint">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="character varying(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <!-- FUNCTION_ROLES - сопоставление ролей и функций
        (роль предполагает выполнение какой-то функции
        - если у пользователя есть роль role_id то он может выполнить функцию function_id) -->
    <changeSet id="23" author="mbragin">
        <createTable tableName="functions_roles">
            <column name="function_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="role_id" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>


        <addUniqueConstraint tableName="functions_roles"
                             columnNames="function_id, role_id"/>

        <addForeignKeyConstraint baseTableName="functions_roles"
                                 baseColumnNames="function_id"
                                 constraintName="functions_roles_function_id"
                                 referencedTableName="functions"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="functions_roles"
                                 baseColumnNames="role_id"
                                 constraintName="functions_roles_role_id"
                                 referencedTableName="roles"
                                 referencedColumnNames="id"/>
    </changeSet>

    <!-- MENU_ITEMS_FUNCTIONS - сопоставление функций и пунктов меню
        (если у пользователя есть роль, которая предполагает собой выполнение функции function_id
        то этот пользователь может видеть пункт меню menu_item_id) -->
    <changeSet id="24" author="mbragin">
        <createTable tableName="menu_items_functions">
            <column name="function_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="menu_item_id" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>


        <addUniqueConstraint tableName="menu_items_functions"
                             columnNames="function_id, menu_item_id"/>

        <addForeignKeyConstraint baseTableName="menu_items_functions"
                                 baseColumnNames="function_id"
                                 constraintName="menu_items_functions_function_id"
                                 referencedTableName="functions"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="menu_items_functions"
                                 baseColumnNames="menu_item_id"
                                 constraintName="menu_items_functions_role_id"
                                 referencedTableName="menu_items"
                                 referencedColumnNames="id"/>
    </changeSet>

    <changeSet id="25" author="mbragin">
        <createSequence sequenceName="organizations_seq"
                        minValue="1"
                        incrementBy="1"/>
    </changeSet>

    <changeSet id="26" author="mbragin">
        <createSequence sequenceName="orders_seq"
                        minValue="1"
                        incrementBy="1"/>
    </changeSet>

    <changeSet id="27" author="mbragin">
        <createSequence sequenceName="users_seq"
                        minValue="1"
                        incrementBy="1"/>
    </changeSet>


    <changeSet id="27" author="mbragin1">
        <createSequence sequenceName="accounts_seq"
                        minValue="1"
                        incrementBy="1"/>
    </changeSet>

    <!-- DELIVERY - статусы доставки в рамках организации -->
    <changeSet id="28" author="mbragin">
        <createTable tableName="deliveries">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="address_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="delivery_type_id" type="bigint">
                <constraints nullable="true"/>
            </column>
            <column name="order_id" type="bigint">
                <constraints nullable="true"/>
            </column>
        </createTable>

        <addForeignKeyConstraint baseTableName="deliveries"
                                 baseColumnNames="delivery_type_id"
                                 constraintName="deliveries_type_id"
                                 referencedTableName="delivery_types"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="deliveries"
                                 baseColumnNames="order_id"
                                 constraintName="deliveries_order_id"
                                 referencedTableName="orders"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="deliveries"
                                 baseColumnNames="address_id"
                                 constraintName="address_id"
                                 referencedTableName="addresses"
                                 referencedColumnNames="id"/>
    </changeSet>

    <!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! MENU ITEMS !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->

    <changeSet id="30" author="mbragin">
        <insert tableName="menu_items">
            <column name="id" valueNumeric="1001"/>
            <column name="name" value="Home"/>
            <column name="visible" value="true"/>
        </insert>
    </changeSet>

    <changeSet id="31" author="mbragin">
        <insert tableName="menu_items">
            <column name="id" valueNumeric="1002"/>
            <column name="name" value="Sales"/>
            <column name="visible" value="true"/>
        </insert>
    </changeSet>

    <changeSet id="32" author="mbragin">
        <insert tableName="menu_items">
            <column name="id" valueNumeric="2201"/>
            <column name="name" value="Orders"/>
            <column name="visible" value="true"/>
            <column name="parent_id" valueNumeric="1002"/>
        </insert>
    </changeSet>

    <changeSet id="33" author="mbragin">
        <insert tableName="menu_items">
            <column name="id" valueNumeric="2202"/>
            <column name="name" value="Invoices to customers"/>
            <column name="visible" value="true"/>
            <column name="parent_id" valueNumeric="1002"/>
        </insert>
    </changeSet>

    <changeSet id="34" author="mbragin">
        <insert tableName="menu_items">
            <column name="id" valueNumeric="2203"/>
            <column name="name" value="Sales Returns"/>
            <column name="visible" value="true"/>
            <column name="parent_id" valueNumeric="1002"/>
        </insert>
    </changeSet>
    <changeSet id="35" author="mbragin">
        <insert tableName="menu_items">
            <column name="id" valueNumeric="10001"/>
            <column name="name" value="Administration"/>
            <column name="visible" value="true"/>
        </insert>
    </changeSet>

    <changeSet id="36" author="mbragin">
        <insert tableName="menu_items">
            <column name="id" valueNumeric="10101"/>
            <column name="name" value="Users"/>
            <column name="visible" value="true"/>
            <column name="parent_id" valueNumeric="10001"/>
        </insert>
    </changeSet>

    <changeSet id="37" author="mbragin">
        <insert tableName="menu_items">
            <column name="id" valueNumeric="10102"/>
            <column name="name" value="Settings"/>
            <column name="visible" value="true"/>
            <column name="parent_id" valueNumeric="10001"/>
        </insert>
    </changeSet>

    <changeSet id="38" author="mbragin">
        <insert tableName="menu_items">
            <column name="id" valueNumeric="1006"/>
            <column name="name" value="Catalog"/>
            <column name="visible" value="true"/>
        </insert>
    </changeSet>

    <changeSet id="39" author="mbragin">
        <insert tableName="menu_items">
            <column name="id" valueNumeric="2601"/>
            <column name="name" value="Goods"/>
            <column name="visible" value="true"/>
            <column name="parent_id" valueNumeric="1006"/>
        </insert>
    </changeSet>


    <!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! PRE-FILLED DATA !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->

    <!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! TESTING DATA !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->

    <changeSet id="40" author="mbragin">
        <insert tableName="accounts">
            <column name="id" valueNumeric="1"/>
            <column name="name" value="mbragin Account"/>
        </insert>
    </changeSet>

    <changeSet id="41" author="mbragin">
        <insert tableName="accounts">
            <column name="id" valueNumeric="2"/>
            <column name="name" value="mbragin Account"/>
        </insert>
    </changeSet>

    <!--<changeSet id="42" author="mbragin">
        <insert tableName="persons">
            <column name="id" valueNumeric="1"/>
            <column name="first_name" value="Dmitry"/>
            <column name="last_name" value="Naumov"/>
            <column name="email" value="mbragin@gmail.com"/>
        </insert>
    </changeSet>

    <changeSet id="43" author="mbragin">
        <insert tableName="persons">
            <column name="id" valueNumeric="2"/>
            <column name="first_name" value="Mikhail"/>
            <column name="last_name" value="Bragin"/>
            <column name="email" value="bangvalo@gmail.com"/>
        </insert>
    </changeSet>

    <changeSet id="44" author="mbragin">
        <insert tableName="persons">
            <column name="id" valueNumeric="3"/>
            <column name="first_name" value="Vladimir"/>
            <column name="last_name" value="Putin"/>
            <column name="email" value="putin@putin.putin"/>
        </insert>
    </changeSet>

    <changeSet id="45" author="mbragin">
        <insert tableName="persons">
            <column name="id" valueNumeric="4"/>
            <column name="first_name" value="Barak"/>
            <column name="last_name" value="Obama"/>
            <column name="email" value="obama@obama.obama"/>
        </insert>
    </changeSet>-->

    <changeSet id="46" author="mbragin">
        <insert tableName="user_statuses">
            <column name="id" valueNumeric="1"/>
            <column name="name" value="active"/>
        </insert>
    </changeSet>

    <changeSet id="47" author="mbragin">
        <insert tableName="user_statuses">
            <column name="id" valueNumeric="2"/>
            <column name="name" value="disabled"/>
        </insert>
    </changeSet>

    <changeSet id="48" author="mbragin">
        <insert tableName="user_statuses">
            <column name="id" valueNumeric="3"/>
            <column name="name" value="not activated"/>
        </insert>
    </changeSet>

    <changeSet id="49" author="mbragin">
        <insert tableName="users">
            <column name="id" valueNumeric="1"/>
            <column name="created" valueDate="2012-01-01 00:00:00"/>
            <column name="status_id" valueNumeric="1"/>
            <column name="account_id" valueNumeric="1"/>
            <column name="username" value="root"/>
            <column name="password" value="root"/>
        </insert>
    </changeSet>

    <changeSet id="50" author="mbragin">
        <insert tableName="users">
            <column name="id" valueNumeric="2"/>
            <column name="created" valueDate="2012-01-01 00:00:00"/>
            <column name="status_id" valueNumeric="1"/>
            <column name="account_id" valueNumeric="2"/>
            <column name="username" value="test"/>
            <column name="password" value="test"/>
        </insert>
    </changeSet>

    <changeSet id="51" author="mbragin">
        <insert tableName="organizations">
            <column name="id" valueNumeric="1"/>
            <column name="name" value="mbragin Inc."/>
            <column name="description" value="mbragin Inc."/>
            <column name="account_id" valueNumeric="1"/>
        </insert>
    </changeSet>

    <changeSet id="52" author="mbragin">
        <insert tableName="organizations">
            <column name="id" valueNumeric="2"/>
            <column name="name" value="mbragin Inc. 2"/>
            <column name="description" value="mbragin Inc. 2"/>
            <column name="account_id" valueNumeric="1"/>
        </insert>
    </changeSet>

    <changeSet id="53" author="mbragin">
        <insert tableName="organizations">
            <column name="id" valueNumeric="3"/>
            <column name="name" value="mbragin Inc."/>
            <column name="description" value="mbragin Inc."/>
            <column name="account_id" valueNumeric="2"/>
        </insert>
    </changeSet>

    <changeSet id="54" author="mbragin">
        <insert tableName="organizations">
            <column name="id" valueNumeric="4"/>
            <column name="name" value="mbragin Inc."/>
            <column name="description" value="mbragin Inc."/>
            <column name="account_id" valueNumeric="2"/>
        </insert>
    </changeSet>

    <changeSet id="55" author="mbragin">
        <insert tableName="delivery_types">
            <column name="id" valueNumeric="1"/>
            <column name="name" value="Delivery Type 1"/>
        </insert>
    </changeSet>

    <changeSet id="56" author="mbragin">
        <insert tableName="delivery_types">
            <column name="id" valueNumeric="2"/>
            <column name="name" value="Delivery Type 2"/>
        </insert>
    </changeSet>

    <changeSet id="57" author="mbragin">
        <insert tableName="delivery_types">
            <column name="id" valueNumeric="3"/>
            <column name="name" value="Delivery Type 3"/>
        </insert>
    </changeSet>

    <changeSet id="58" author="mbragin">
        <insert tableName="delivery_types">
            <column name="id" valueNumeric="4"/>
            <column name="name" value="Delivery Type 1"/>
        </insert>
    </changeSet>

    <changeSet id="59" author="mbragin">
        <insert tableName="delivery_types">
            <column name="id" valueNumeric="5"/>
            <column name="name" value="Delivery Type 1"/>
        </insert>
    </changeSet>

    <changeSet id="60" author="mbragin">
        <insert tableName="customers">
            <column name="id" valueNumeric="1"/>
            <column name="organization_id" valueNumeric="1"/>
        </insert>
    </changeSet>

    <changeSet id="61" author="mbragin">
        <insert tableName="customers">
            <column name="id" valueNumeric="2"/>
            <column name="organization_id" valueNumeric="1"/>
        </insert>
    </changeSet>

    <changeSet id="62" author="mbragin">
        <insert tableName="customers">
            <column name="id" valueNumeric="3"/>
            <column name="organization_id" valueNumeric="2"/>
        </insert>
    </changeSet>

    <changeSet id="63" author="mbragin">
        <insert tableName="customers">
            <column name="id" valueNumeric="4"/>
            <column name="organization_id" valueNumeric="2"/>
        </insert>
    </changeSet>

    <changeSet id="64" author="mbragin">
        <insert tableName="customers">
            <column name="id" valueNumeric="5"/>
            <column name="organization_id" valueNumeric="3"/>
        </insert>
    </changeSet>

    <changeSet id="65" author="mbragin">
        <insert tableName="customers">
            <column name="id" valueNumeric="6"/>
            <column name="organization_id" valueNumeric="3"/>
        </insert>
    </changeSet>

    <changeSet id="66" author="mbragin">
        <insert tableName="customers">
            <column name="id" valueNumeric="7"/>
            <column name="organization_id" valueNumeric="4"/>
        </insert>
    </changeSet>

    <changeSet id="67" author="mbragin">
        <insert tableName="customers">
            <column name="id" valueNumeric="8"/>
            <column name="organization_id" valueNumeric="4"/>
        </insert>
    </changeSet>

    <changeSet id="68" author="mbragin">
        <insert tableName="order_statuses">
            <column name="id" valueNumeric="1"/>
            <column name="name" value="new"/>
        </insert>
    </changeSet>

    <changeSet id="69" author="mbragin">
        <insert tableName="order_statuses">
            <column name="id" valueNumeric="2"/>
            <column name="name" value="accepted"/>
        </insert>
    </changeSet>

    <changeSet id="70" author="mbragin">
        <insert tableName="orders">
            <column name="id" valueNumeric="1"/>
            <column name="order_date" valueDate="2012-02-19 10:23:54+02"/>
            <column name="delivery_date" valueDate="2012-04-19 10:23:54+02"/>
            <column name="order_number" valueNumeric="1"/>
            <column name="customer_id" valueNumeric="1"/>
            <column name="organization_id" valueNumeric="1"/>
            <column name="status_id" valueNumeric="1"/>
        </insert>
    </changeSet>

    <changeSet id="71" author="mbragin">
        <insert tableName="orders">
            <column name="id" valueNumeric="2"/>
            <column name="order_date" valueDate="2012-02-20 10:23:54+02"/>
            <column name="delivery_date" valueDate="2012-04-19 10:23:54+02"/>
            <column name="order_number" valueNumeric="2"/>
            <column name="customer_id" valueNumeric="2"/>
            <column name="organization_id" valueNumeric="1"/>
            <column name="status_id" valueNumeric="2"/>
        </insert>
    </changeSet>

    <changeSet id="72" author="mbragin">
        <insert tableName="orders">
            <column name="id" valueNumeric="3"/>
            <column name="order_date" valueDate="2012-02-19 10:23:54+02"/>
            <column name="delivery_date" valueDate="2012-04-19 10:23:54+02"/>
            <column name="order_number" valueNumeric="1"/>
            <column name="customer_id" valueNumeric="3"/>
            <column name="organization_id" valueNumeric="3"/>
            <column name="status_id" valueNumeric="1"/>
        </insert>
    </changeSet>

    <changeSet id="73" author="mbragin">
        <insert tableName="orders">
            <column name="id" valueNumeric="4"/>
            <column name="order_date" valueDate="2012-02-20 10:23:54+02"/>
            <column name="delivery_date" valueDate="2012-04-19 10:23:54+02"/>
            <column name="order_number" valueNumeric="2"/>
            <column name="customer_id" valueNumeric="4"/>
            <column name="organization_id" valueNumeric="3"/>
            <column name="status_id" valueNumeric="2"/>
        </insert>
    </changeSet>

    <changeSet id="74" author="mbragin">
        <insert tableName="addresses">
            <column name="id" valueNumeric="1"/>
            <column name="address" value="Address 123"/>
        </insert>
    </changeSet>

    <changeSet id="76" author="mbragin">
        <insert tableName="addresses">
            <column name="id" valueNumeric="2"/>
            <column name="address" value="Address 2345678"/>
        </insert>
    </changeSet>

    <changeSet id="78" author="mbragin">
        <insert tableName="phones">
            <column name="id" valueNumeric="1"/>
            <column name="phone" value="+70000000000"/>
        </insert>
    </changeSet>

    <changeSet id="80" author="mbragin">
        <insert tableName="phones">
            <column name="id" valueNumeric="2"/>
            <column name="phone" value="+70000000001"/>
        </insert>
    </changeSet>

    <changeSet id="81" author="mbragin">
        <update tableName="customers">
            <column name="first_name" valueNumeric="'Customer 1 First Name'"/>
            <column name="last_name" valueNumeric="'Customer 1 Last Name'"/>
            <column name="email" valueNumeric="'customer1@email.com'"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="82" author="mbragin">
        <update tableName="customers">
            <column name="first_name" valueNumeric="'Customer 2 First Name'"/>
            <column name="last_name" valueNumeric="'Customer 2 Last Name'"/>
            <column name="email" valueNumeric="'customer2@email.com'"/>
            <where>id=2</where>
        </update>
    </changeSet>

    <changeSet id="83" author="mbragin">
        <update tableName="customers">
            <column name="first_name" valueNumeric="'Customer 3 First Name'"/>
            <column name="last_name" valueNumeric="'Customer 3 Last Name'"/>
            <column name="email" valueNumeric="'customer3@email.com'"/>
            <where>id=3</where>
        </update>
    </changeSet>

    <changeSet id="84" author="mbragin">
        <addColumn tableName="users">
            <column name="first_name" type="varchar(255)"/>
            <column name="last_name" type="varchar(255)"/>
            <column name="email" type="varchar(255)"/>
        </addColumn>
    </changeSet>

    <changeSet id="85" author="mbragin">
        <update tableName="orders">
            <column name="address_id" valueNumeric="1"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="86" author="mbragin">
        <update tableName="orders">
            <column name="address_id" valueNumeric="2"/>
            <where>id=2</where>
        </update>
    </changeSet>

    <changeSet id="87" author="mbragin">
        <addColumn tableName="orders">
            <column name="delivery_type_id" type="bigint">
                <constraints nullable="true"/>
            </column>
        </addColumn>

        <addForeignKeyConstraint baseTableName="orders"
                                 baseColumnNames="delivery_type_id"
                                 constraintName="deliveries_type_id"
                                 referencedTableName="delivery_types"
                                 referencedColumnNames="id"/>
    </changeSet>

    <changeSet id="88" author="mbragin">
        <dropTable tableName="deliveries"/>
    </changeSet>

    <changeSet id="89" author="mbragin">
        <update tableName="orders">
            <column name="delivery_type_id" value="1"/>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="90" author="mbragin">
        <update tableName="orders">
            <column name="delivery_type_id" value="2"/>
            <where>id=2</where>
        </update>
    </changeSet>

    <changeSet id="91" author="mbragin">
        <createTable tableName="measures">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(255)"/>
        </createTable>
    </changeSet>

    <changeSet id="92" author="mbragin">
        <addColumn tableName="goods">
            <column name="organization_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="measure_id" type="bigint"/>
            <column name="article" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="varchar(255)"/>
        </addColumn>

        <addForeignKeyConstraint baseTableName="goods"
                                 baseColumnNames="measure_id"
                                 constraintName="goods_measure_id"
                                 referencedTableName="measures"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="goods"
                                 baseColumnNames="organization_id"
                                 constraintName="goods_organization_id"
                                 referencedTableName="organizations"
                                 referencedColumnNames="id"/>
    </changeSet>

    <changeSet id="93" author="mbragin">
        <insert tableName="goods">
            <column name="id" value="1"></column>
            <column name="name" value="'Samsung LE-32L4000'"></column>
            <column name="description" value="'Телевизор вери гуд'"></column>
            <column name="article" value="TV1234"></column>
            <column name="organization_id" value="1"></column>
            <column name="account_id" value="1"></column>
        </insert>
    </changeSet>

    <changeSet id="94" author="mbragin">
        <insert tableName="measures">
            <column name="id" value="1"></column>
            <column name="name" value="Руб"></column>
        </insert>
    </changeSet>

    <changeSet id="95" author="mbragin">
        <insert tableName="measures">
            <column name="id" value="2"></column>
            <column name="name" value="кг"></column>
        </insert>
    </changeSet>

    <changeSet id="96" author="mbragin">
        <insert tableName="measures">
            <column name="id" value="3"></column>
            <column name="name" value="шт."></column>
        </insert>
    </changeSet>

    <changeSet id="97" author="mbragin">
        <insert tableName="goods">
            <column name="id" value="2"></column>
            <column name="name" value="'Samsung LE-22L4000'"></column>
            <column name="description" value="'Телевизор вери гуд 2'"></column>
            <column name="article" value="TV1235"></column>
            <column name="organization_id" value="1"></column>
            <column name="account_id" value="1"></column>
        </insert>
    </changeSet>

    <changeSet id="98" author="mbragin">
        <insert tableName="goods">
            <column name="id" value="3"></column>
            <column name="name" value="'BBK-DV5000'"></column>
            <column name="description" value="'Дивиди вери гуд'"></column>
            <column name="article" value="TV1236"></column>
            <column name="organization_id" value="1"></column>
            <column name="account_id" value="1"></column>
        </insert>
    </changeSet>

    <changeSet id="99" author="mbragin">
        <dropColumn tableName="goods" columnName="price"/>
    </changeSet>

    <changeSet id="100" author="mbragin">
        <update tableName="goods">
            <column name="measure_id" value="1"></column>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="101" author="mbragin">
        <update tableName="goods">
            <column name="measure_id" value="1"></column>
            <where>id=2</where>
        </update>
    </changeSet>

    <changeSet id="102" author="mbragin">
        <update tableName="goods">
            <column name="measure_id" value="3"></column>
            <where>id=3</where>
        </update>
    </changeSet>

    <changeSet id="103" author="mbragin">
        <addColumn tableName="measures">
            <column name="account_id" type="bigint"/>
        </addColumn>
    </changeSet>

    <changeSet id="104" author="mbragin">
        <update tableName="measures">
            <column name="account_id" value="1"></column>
            <where>id=1</where>
        </update>
    </changeSet>

    <changeSet id="105" author="mbragin">
        <update tableName="measures">
            <column name="account_id" value="1"></column>
            <where>id=2</where>
        </update>
    </changeSet>

    <changeSet id="106" author="mbragin">
        <update tableName="measures">
            <column name="account_id" value="1"></column>
            <where>id=3</where>
        </update>
    </changeSet>

    <changeSet id="107" author="mbragin">
        <insert tableName="measures">
            <column name="id" value="4"></column>
            <column name="name" value="Руб"></column>
            <column name="account_id" value="2"></column>
        </insert>
    </changeSet>

    <changeSet id="108" author="mbragin">
        <insert tableName="measures">
            <column name="id" value="5"></column>
            <column name="name" value="кг"></column>
            <column name="account_id" value="2"></column>
        </insert>
    </changeSet>

    <changeSet id="109" author="mbragin">
        <insert tableName="measures">
            <column name="id" value="6"></column>
            <column name="name" value="шт."></column>
            <column name="account_id" value="2"></column>
        </insert>
    </changeSet>

    <changeSet id="110" author="mbragin">
        <addForeignKeyConstraint baseTableName="measures"
                                 baseColumnNames="account_id"
                                 constraintName="measures_account_id"
                                 referencedTableName="accounts"
                                 referencedColumnNames="id"/>

        <addNotNullConstraint tableName="measures"
                              columnName="account_id"/>

    </changeSet>

    <changeSet id="111" author="mbragin">
        <insert tableName="goods">
            <column name="id" value="4"></column>
            <column name="name" value="'Samsung LE-22L4000'"></column>
            <column name="description" value="'Телевизор вери гуд'"></column>
            <column name="article" value="TV123"></column>
            <column name="organization_id" value="2"></column>
            <column name="account_id" value="2"></column>
            <column name="measure_id" value="3"></column>
        </insert>
    </changeSet>

    <changeSet id="112" author="mbragin">
        <insert tableName="goods">
            <column name="id" value="5"></column>
            <column name="name" value="'BBK-DV5000'"></column>
            <column name="description" value="'Дивиди вери гуд'"></column>
            <column name="article" value="DVD234"></column>
            <column name="organization_id" value="2"></column>
            <column name="account_id" value="2"></column>
            <column name="measure_id" value="1"></column>
        </insert>
    </changeSet>

    <changeSet id="113" author="mbragin">
        <insert tableName="goods">
            <column name="id" value="6"></column>
            <column name="name" value="'Samsung LE-47'"></column>
            <column name="description" value="'Телевизор вери гуд'"></column>
            <column name="article" value="TV1236"></column>
            <column name="organization_id" value="2"></column>
            <column name="account_id" value="2"></column>
            <column name="measure_id" value="1"></column>
        </insert>
    </changeSet>

    <changeSet id="114" author="mbragin">
        <insert tableName="goods">
            <column name="id" value="7"></column>
            <column name="name" value="'BBK-DV765'"></column>
            <column name="description" value="'Дивиди вери гуд'"></column>
            <column name="article" value="DVD123"></column>
            <column name="organization_id" value="2"></column>
            <column name="account_id" value="2"></column>
            <column name="measure_id" value="3"></column>
        </insert>
    </changeSet>

    <changeSet id="115" author="mbragin">
        <addAutoIncrement tableName="goods" columnName="id"/>
    </changeSet>

    <changeSet id="116" author="mbragin">
        <addAutoIncrement tableName="orders" columnName="id"/>
    </changeSet>

	<changeSet id="117" author="mbragin">
		<sql>ALTER SEQUENCE goods_id_seq START 20</sql>
		<sql>ALTER SEQUENCE goods_id_seq RESTART</sql>
		<sql>ALTER SEQUENCE accounts_seq START 20</sql>
		<sql>ALTER SEQUENCE accounts_seq RESTART</sql>
		<sql>ALTER SEQUENCE orders_id_seq START 20</sql>
		<sql>ALTER SEQUENCE orders_id_seq RESTART</sql>
		<sql>ALTER SEQUENCE organizations_seq START 20</sql>
		<sql>ALTER SEQUENCE organizations_seq RESTART</sql>
		<sql>ALTER SEQUENCE users_seq START 20</sql>
		<sql>ALTER SEQUENCE users_seq RESTART</sql>
	</changeSet>
	<changeSet id="118" author="mbragin">
		<sql>ALTER SEQUENCE orders_seq START 20</sql>
		<sql>ALTER SEQUENCE orders_seq RESTART</sql>
	</changeSet>

</databaseChangeLog>